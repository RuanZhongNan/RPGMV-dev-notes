# 用 vercel cli 编写简单的 github action 完成部署

## 参考资料

工作流配置：

- https://vercel.com/guides/how-can-i-use-github-actions-with-vercel
- https://vercel.com/guides/how-to-alias-a-preview-deployment-using-the-cli

Build Output API：

- https://vercel.com/blog/build-output-api

## 思路变化

之前想的是尽量避免亲自使用 vercel cli 命令行，现在发现现成的 github action 不够用，不注意支撑 monorepo 项目的部署。

故考虑写适应自己需求的工作流。

## 1. 根目录单一 vercel.json，一次部署

- https://vercel.com/docs/build-output-api/v3/primitives#static-files

该方案需要考虑根目录下的 `.vercel/output/static` 的文件划分。

这个目录将会包含全部子项目的内容。

考虑项如下：

- vuepress2 打包配置要设置 dest 打包目录。
- vuepress2 可能还要配置 base 路径，以便映射 url，确保 css 资源加载正确。
- 两次连续的 vercel build 会覆盖掉之前已经打包好的项目。会清空掉 `.vercel/output/static` 内的静态资源。故 build 命令只能运行一次。
- 需要查询 url 域名配置的 api，以便确保单一目录可以映射多个 url

## 2. 各子目录各自部署

- `.vercel/output/static` 的位置不合适，可能无法使用根目录提供的 pnpm 命令。可能无法实现集中化调度。

## 3. 基于 `Build Output API` 的各子目录各自部署

- https://vercel.com/blog/build-output-api
- https://vercel.com/blog/behind-the-scenes-of-vercels-infrastructure

![2024-06-25-23-32-24](https://cdn.jsdelivr.net/gh/RuanZhongNan/img-store/img/2024-06-25-23-32-24.png)

可以考虑直接让 vuepress2 自己定向打包，满足 `.vercel/output/static` 的位置即可，剩下的直接就部署即可。
