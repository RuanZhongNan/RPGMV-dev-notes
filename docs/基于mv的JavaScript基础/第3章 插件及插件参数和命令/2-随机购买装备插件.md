# 2-随机购买装备插件
做一个随机购买装备的插件，使用1000元钱，然后随机从设置好的装备列表获得一件装备，主要看运气，有可能获得一件小木剑，也有可能获得屠龙刀。





## 所有装备的列表在哪里呢？
所有装备的列表，是在data文件夹下面以json的形式记录着，在游戏进行的时候，会依照着json文件中的数据创建一个一样的对象，各个对象的对应关系可以从rpg_manager.js中看到，如下代码。我们可以调用```$dataWeapons```来获得武器的信息。```$dataWeapons```是全局变量，可以直接在你的插件内调用。

``` js
DataManager._databaseFiles = [{
		name: '$dataActors',
		src: 'Actors.json'
	},
	{
		name: '$dataClasses',
		src: 'Classes.json'
	},
	{
		name: '$dataSkills',
		src: 'Skills.json'
	},
	{
		name: '$dataItems',
		src: 'Items.json'
	},
	{
		name: '$dataWeapons',
		src: 'Weapons.json'
	},
	{
		name: '$dataArmors',
		src: 'Armors.json'
	},
	{
		name: '$dataEnemies',
		src: 'Enemies.json'
	},
	{
		name: '$dataTroops',
		src: 'Troops.json'
	},
	{
		name: '$dataStates',
		src: 'States.json'
	},
	{
		name: '$dataAnimations',
		src: 'Animations.json'
	},
	{
		name: '$dataTilesets',
		src: 'Tilesets.json'
	},
	{
		name: '$dataCommonEvents',
		src: 'CommonEvents.json'
	},
	{
		name: '$dataSystem',
		src: 'System.json'
	},
	{
		name: '$dataMapInfos',
		src: 'MapInfos.json'
	}
];
```





## 怎么获得装备呢？
通过在各个核心js文件中搜索gain item、 change item等关键词，我们找到了获得物品的函数是放在rpg_objects.js中的Game_Party.prototype.gainItem函数。这样的话，我们也可以调用这个函数来获取装备，如下代码：

```js
//获得物品
Game_Party.prototype.gainItem = function (item, amount, includeEquip) {
	//容器 = 物品容器(项目)
	var container = this.itemContainer(item);
	//如果(容器)
	if (container) {
		//之前数目 = 物品数字(项目)
		var lastNumber = this.numItems(item);
		//新数目 = 之前数目 +  数量
		var newNumber = lastNumber + amount;
		//容器[项目 id] = 新数目 在之间(0 , 最大物品数(项目) )
		container[item.id] = newNumber.clamp(0, this.maxItems(item));
		//如果(容器[项目 id] === 0 )
		if (container[item.id] === 0) {
			//删除 容器[项目 id]
			delete container[item.id];
		}
		//如果(包含装备 并且 新数目 < 0 )
		if (includeEquip && newNumber < 0) {
			//抛弃成员装备(项目 , -新数目 )
			this.discardMembersEquip(item, -newNumber);
		}
		//游戏地图 请求刷新()
		$gameMap.requestRefresh();
	}
};
```





## 怎么获得并且控制当前的金钱数量呢？
一样的对gold，money等进行搜索，我们找到了控制金钱数量的方法，Game_Party.prototype.gold等等，如下代码：

```js
//金钱
Game_Party.prototype.gold = function () {
	//返回 金钱
	return this._gold;
};

//获得金钱
Game_Party.prototype.gainGold = function (amount) {
	//金钱 = (金钱 + 数量 ) 在之间(0,最大金钱)
	this._gold = (this._gold + amount).clamp(0, this.maxGold());
};

//失去金钱
Game_Party.prototype.loseGold = function (amount) {
	//获得金钱(-数量)
	this.gainGold(-amount);
};

//最大金钱
Game_Party.prototype.maxGold = function () {
	//返回 99999999
	return 99999999;
};
```





## 随机数怎么得到？
这里，我们介绍几个js自带的函数。

Math.random(); 结果为0-1间的一个随机数(包括0,不包括1)
Math.floor(num); 参数num为一个数值，函数结果为num的整数部分。
Math.round(num); 参数num为一个数值，函数结果为num四舍五入后的整数。

利用这三个函数，我们就可以获得我们想要的随机数。

